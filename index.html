<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Sunset Dunes Local Businesses</title><style>:root { --primary: #007bff; --bg: #f4f4f4; }body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; height: 100vh; display: flex; flex-direction: column; }header { background: #fff; padding: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 1000; position: relative; display: flex; gap: 10px; flex-wrap: wrap; }#map { flex-grow: 1; z-index: 1; }#list-view { display: none; flex-grow: 1; overflow-y: auto; background: var(--bg); padding: 10px; }select, button { padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; background: #fff; font-size: 14px; cursor: pointer; }button.active { background: var(--primary); color: white; border-color: var(--primary); }.biz-card { background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }.biz-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }.biz-name { margin: 0; font-size: 1.1em; font-weight: bold; }.biz-type { font-size: 0.8em; text-transform: uppercase; color: #666; background: #eee; padding: 2px 6px; border-radius: 4px; }.biz-status { font-weight: bold; font-size: 0.9em; }.open { color: green; }.closed { color: red; }.biz-actions { margin-top: 10px; display: flex; gap: 10px; }.btn-link { text-decoration: none; color: var(--primary); font-size: 0.9em; font-weight: 500; }.leaflet-popup-content-wrapper { border-radius: 8px; padding: 0; }.leaflet-popup-content { margin: 0; width: 280px !important; }.popup-card { border: none; box-shadow: none; margin: 0; }.custom-icon { text-align: center; line-height: 30px; font-size: 20px; background: white; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }.marker-cluster { background-clip: padding-box; border-radius: 50%; display: flex; align-items: center; justify-content: center; }.marker-cluster div { width: 30px; height: 30px; margin: 5px; text-align: center; border-radius: 50%; font: 12px "Helvetica Neue", Arial, Helvetica, sans-serif; font-weight: bold; display: flex; align-items: center; justify-content: center; }.marker-cluster-small { background-color: rgba(110, 204, 57, 0.6); }.marker-cluster-small div { background-color: rgba(110, 204, 57, 0.8); color: white; }.marker-cluster-medium { background-color: rgba(240, 194, 12, 0.6); }.marker-cluster-medium div { background-color: rgba(240, 194, 12, 0.8); color: white; }.marker-cluster-large { background-color: rgba(241, 128, 23, 0.6); }.marker-cluster-large div { background-color: rgba(241, 128, 23, 0.8); color: white; }.stacked-icon { position: relative; text-align: center; line-height: 30px; font-size: 20px; background: white; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }.stacked-icon .stack-count { position: absolute; top: -8px; right: -8px; background: #ff4444; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 11px; font-weight: bold; line-height: 18px; text-align: center; border: 2px solid white; }.multi-icon-cluster { background: white; border-radius: 20px; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3); display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 4px 6px; }.multi-icon-cluster .cluster-icons { display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 2px; }.multi-icon-cluster .cluster-type-icon { font-size: 16px; line-height: 1; }.multi-icon-cluster .cluster-count { font-size: 10px; font-weight: bold; color: #666; margin-top: 1px; }.cluster-popup-content { max-height: 300px; overflow-y: auto; }.cluster-popup-content .biz-card { border-bottom: 1px solid #eee; margin-bottom: 10px; padding-bottom: 10px; }.cluster-popup-content .biz-card:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }.dropdown { position: relative; min-width: 140px; }.dropdown-selected { padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; background: #fff; font-size: 14px; cursor: pointer; display: flex; align-items: center; justify-content: space-between; gap: 8px; white-space: nowrap; }.dropdown-selected:hover { border-color: #999; }.dropdown-text { display: flex; align-items: center; gap: 4px; }.dropdown-arrow { font-size: 10px; color: #666; transition: transform 0.2s; }.dropdown.open .dropdown-arrow { transform: rotate(180deg); }.dropdown-options { display: none; position: absolute; top: 100%; left: 0; right: 0; background: #fff; border: 1px solid #ccc; border-radius: 4px; margin-top: 4px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 10000; max-height: 300px; overflow-y: auto; min-width: 180px; }.dropdown.open .dropdown-options { display: block; }.dropdown-item { padding: 10px 12px; cursor: pointer; display: flex; align-items: center; gap: 8px; }.dropdown-item:hover { background: #f5f5f5; }.item-emoji { font-size: 16px; width: 24px; text-align: center; }.item-label { flex: 1; }.category-header { font-weight: 500; }.category-header .item-label { flex: 1; }.expand-toggle { font-size: 10px; color: #666; padding: 4px 8px; cursor: pointer; transition: transform 0.2s; }.expand-toggle:hover { color: #333; background: #eee; border-radius: 4px; }.expand-toggle.expanded { color: var(--primary); }.subcategory-list { display: none; background: #fafafa; }.subcategory-list.expanded { display: block; }.subcategory-item { padding-left: 28px; font-size: 13px; }.subcategory-item .item-emoji { font-size: 14px; }.dropdown-category { border-bottom: 1px solid #eee; }.dropdown-category:last-child { border-bottom: none; }</style><link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" /><link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" /></head><body><header><div id="filter-dropdown" class="dropdown"><div class="dropdown-selected"></div><div class="dropdown-options"></div></div><button id="btn-map" class="active">Map</button><button id="btn-list">List</button><button id="btn-loc">üìç Me</button></header><div id="map"></div><div id="list-view"></div><script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script><script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script><script>const rawData = {"title":"Sunset Dunes Local Businesses","map_defaults":{"lat":37.74914,"long":-122.50722,"zoom":15,"min_zoom":13,"max_bounds":[[37.72,-122.53],[37.79,-122.45]]},"businesses":[{"id":"hookfish","name":"Hookfish","type":["restaurant"],"address":"4542 Irving St, San Francisco, CA 94122","phone":"555-0199","description":"Fresh sustainable seafood restaurant.","hours":{"monday":"07:00-16:00","tuesday":"07:00-16:00","wednesday":"07:00-16:00","thursday":"07:00-16:00","friday":"07:00-16:00","saturday":"08:00-14:00","sunday":"Closed"},"holiday_hours":{"2025-12-25":"Closed","2026-01-01":"10:00-14:00"},"lat":37.7623888,"long":-122.5068638},{"id":"blackbird_books","name":"black Bird Books & Caf√©","type":["bookstore","cafe"],"address":"4541 Irving St, San Francisco, CA 94122","phone":"415 555-0200","description":"Curated Book store with great kids section and wonderful coffee and pastries","hours":{"default":"11:00-22:00","sunday":"12:00-20:00"},"holiday_hours":{"2025-12-25":"Closed","2026-01-01":"10:00-14:00"},"lat":37.7621147,"long":-122.5067687},{"id":"swell_bikes","name":"Swell Bicycles","type":["bikeshop"],"address":"4002 Irving St, San Francisco, CA 94122","phone":"415 555-0200","description":"Local bike shop","hours":{"default":"11:00-22:00","sunday":"12:00-20:00"},"holiday_hours":{"2025-12-25":"Closed","2026-01-01":"10:00-14:00"},"lat":37.7626623,"long":-122.5008937},{"id":"day_moon","name":"Day Moon","type":["bakery"],"address":"3928 Irving St, San Francisco, CA 94122","phone":"415 555-0200","description":"Local bakery with bread, pastries, and premade sandwiches","hours":{"default":"11:00-22:00","sunday":"12:00-20:00"},"holiday_hours":{"2025-12-25":"Closed","2026-01-01":"10:00-14:00"},"lat":37.762693,"long":-122.5001682}],"locations":[{"id":"lawton","name":"Lawton & Sunset Dunes","lat":37.75651,"long":-122.50924,"zoom":15}]};const businesses = rawData.businesses;const categoryHierarchy={food:{emoji:"üç¥",label:"Food",subcategories:{bakery:{emoji:"ü•ñ",label:"Bakery"},restaurant:{emoji:"üçΩ",label:"Restaurant"},cafe:{emoji:"‚òï",label:"Caf√©"}}},drink:{emoji:"üçπ",label:"Drink",subcategories:{bar:{emoji:"üç∫",label:"Bar"},cafe:{emoji:"‚òï",label:"Caf√©"}}},shopping:{emoji:"üõí",label:"Shopping",subcategories:{bookstore:{emoji:"üìö",label:"Bookstore"},bikeshop:{emoji:"üö≤",label:"Bike Shop"},store:{emoji:"üõçÔ∏è",label:"Store"}}}};function getSubcategoryTypes(e){return categoryHierarchy[e]?Object.keys(categoryHierarchy[e].subcategories):[]}function typeInBroadCategory(e,t){return getSubcategoryTypes(t).includes(e)}function getOpenStatus(e,t=new Date){const a=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][t.getDay()],n=t.toISOString().split("T")[0];let o=null;if(e.holiday_hours?.[n]?o=e.holiday_hours[n]:e.hours&&(o=e.hours[a]||e.hours.default),!o||"Closed"===o)return{isOpen:!1,text:"Closed today"};const[s,r]=o.split("-"),[i,l]=s.split(":").map(Number),[c,p]=r.split(":").map(Number),d=60*t.getHours()+t.getMinutes(),u=d>=60*i+l&&d<60*c+p;return{isOpen:u,text:u?`Open until ${r}`:`Closed (Opens ${s})`}}function getIconHtml(e){return{cafe:"‚òï",restaurant:"üçΩ",store:"üõçÔ∏è",bar:"üç∫",bookstore:"üìö",bikeshop:"üö≤",bakery:"ü•ñ"}[e]||"üìç"}function getDisplayType(e,t){if(t&&"all"!==t){const a=Array.isArray(e.type)?e.type:[e.type];if(a.includes(t))return t;if(categoryHierarchy[t]){const e=getSubcategoryTypes(t),n=a.find(t=>e.includes(t));if(n)return n}}return Array.isArray(e.type)?e.type[0]:e.type}function filterBusinesses(e,t){if("all"===t)return e;if(categoryHierarchy[t]){const a=getSubcategoryTypes(t);return e.filter(e=>(Array.isArray(e.type)?e.type:[e.type]).some(e=>a.includes(e)))}return e.filter(e=>Array.isArray(e.type)?e.type.includes(t):e.type===t)}let map,userMarker;"undefined"!=typeof module&&module.exports&&(module.exports={getOpenStatus:getOpenStatus,getIconHtml:getIconHtml,filterBusinesses:filterBusinesses,getDisplayType:getDisplayType,categoryHierarchy:categoryHierarchy,getSubcategoryTypes:getSubcategoryTypes,typeInBroadCategory:typeInBroadCategory});let currentView="map",currentFilter="all",userLoc=null,markers=[],markerClusterGroup=null;const expandedCategories={};let activeClusterPopup=null;function buildHierarchicalDropdown(){const e=document.getElementById("filter-dropdown"),t=e.querySelector(".dropdown-selected"),a=e.querySelector(".dropdown-options");t.innerHTML='<span class="dropdown-text">All Places</span><span class="dropdown-arrow">‚ñº</span>';let n='<div class="dropdown-item" data-value="all"><span class="item-emoji">üìç</span><span class="item-label">All Places</span></div>';for(const[e,t]of Object.entries(categoryHierarchy)){n+=`\n\t\t\t<div class="dropdown-category" data-category="${e}">\n\t\t\t\t<div class="category-header dropdown-item" data-value="${e}">\n\t\t\t\t\t<span class="item-emoji">${t.emoji}</span>\n\t\t\t\t\t<span class="item-label">${t.label}</span>\n\t\t\t\t\t<span class="expand-toggle" data-category="${e}">‚ñ∂</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="subcategory-list" data-category="${e}">`;for(const[e,a]of Object.entries(t.subcategories))n+=`\n\t\t\t\t\t<div class="dropdown-item subcategory-item" data-value="${e}">\n\t\t\t\t\t\t<span class="item-emoji">${a.emoji}</span>\n\t\t\t\t\t\t<span class="item-label">${a.label}</span>\n\t\t\t\t\t</div>`;n+="\n\t\t\t\t</div>\n\t\t\t</div>"}a.innerHTML=n}function setupDropdownEvents(){const e=document.getElementById("filter-dropdown"),t=e.querySelector(".dropdown-selected"),a=e.querySelector(".dropdown-options");t.addEventListener("click",t=>{t.stopPropagation(),e.classList.toggle("open")}),document.addEventListener("click",t=>{e.contains(t.target)||e.classList.remove("open")}),a.addEventListener("click",n=>{const o=n.target.closest(".expand-toggle");if(o){n.stopPropagation();const e=o.dataset.category,t=a.querySelector(`.subcategory-list[data-category="${e}"]`);return void(expandedCategories[e]?(expandedCategories[e]=!1,t.classList.remove("expanded"),o.textContent="‚ñ∂",o.classList.remove("expanded")):(expandedCategories[e]=!0,t.classList.add("expanded"),o.textContent="‚ñº",o.classList.add("expanded")))}const s=n.target.closest(".dropdown-item");if(s&&!s.classList.contains("category-header")||s?.classList.contains("category-header")&&!n.target.closest(".expand-toggle")){const a=s.dataset.value,n=s.querySelector(".item-emoji").textContent,o=s.querySelector(".item-label").textContent;t.innerHTML=`<span class="dropdown-text">${n} ${o}</span><span class="dropdown-arrow">‚ñº</span>`,currentFilter=a,e.classList.remove("open"),updateApp()}})}function createCardHTML(e){const t=getOpenStatus(e),a=t.isOpen?"open":"closed",n=Array.isArray(e.type)?e.type.join(" & "):e.type;return`\n                <div class="biz-card popup-card">\n                    <div class="biz-header">\n                        <span class="biz-name">${e.name}</span>\n                        <span class="biz-type">${n}</span>\n                    </div>\n                    <div class="biz-status ${a}">${t.text}</div>\n                <p>${e.description}</p>\n                <div class="biz-actions">\n                     <a href="https://www.google.com/maps/dir/?api=1&destination=${e.lat},${e.long}" target="_blank" class="btn-link">Navigate ‚Üó</a>\n                     ${e.phone?`<a href="tel:${e.phone}" class="btn-link">Call</a>`:""}\n                </div>\n            </div>\n        `}function renderList(e){const t=document.getElementById("list-view");t.innerHTML="",0===e.length&&(t.innerHTML='<p style="text-align:center; margin-top:20px;">No results found.</p>'),e.forEach(e=>{t.innerHTML+=createCardHTML(e)})}function renderMap(e){markerClusterGroup&&map.removeLayer(markerClusterGroup),markers=[],markerClusterGroup=L.markerClusterGroup({maxClusterRadius:40,spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!1,iconCreateFunction:e=>{const t=e.getAllChildMarkers(),a=t.length,n=t.map(e=>e.options.businessType),o=[...new Set(n)];if(1===o.length){const e=getIconHtml(o[0]);return L.divIcon({className:"stacked-icon",html:`${e}<span class="stack-count">${a}</span>`,iconSize:[40,40],iconAnchor:[20,20]})}{const e=o.map(e=>`<span class="cluster-type-icon">${getIconHtml(e)}</span>`).join(""),t=Math.min(28*o.length+12,120),n=a>o.length,s=n?`<span class="cluster-count">${a}</span>`:"";return L.divIcon({className:"multi-icon-cluster",html:`<div class="cluster-icons">${e}</div>${s}`,iconSize:[t,n?44:30],iconAnchor:[t/2,n?22:15]})}}}),markerClusterGroup.on("clusterclick",e=>{const t=e.layer,a=t.getAllChildMarkers(),n=a.map(e=>e.options.originalBusiness);let o='<div class="cluster-popup-content">';a.forEach(e=>{o+=e.options.popupContent}),o+="</div>";const s=L.popup().setLatLng(t.getLatLng()).setContent(o).openOn(map);activeClusterPopup={popup:s,businesses:n},s.on("remove",()=>{activeClusterPopup&&activeClusterPopup.popup===s&&(activeClusterPopup=null)})}),e.forEach(e=>{const t=getDisplayType(e,currentFilter),a=L.divIcon({className:"custom-icon",html:getIconHtml(t),iconSize:[30,30],iconAnchor:[15,15]}),n=createCardHTML(e),o=L.marker([e.lat,e.long],{icon:a,businessType:t,popupContent:n,originalBusiness:e});o.bindPopup(n),markers.push(o),markerClusterGroup.addLayer(o)}),map.addLayer(markerClusterGroup)}function updateApp(){const e=filterBusinesses(businesses,currentFilter);if(userLoc&&(e.forEach(e=>{e.distance=map.distance(userLoc,[e.lat,e.long])}),e.sort((e,t)=>e.distance-t.distance)),"map"===currentView?renderMap(e):renderList(e),activeClusterPopup&&map.hasLayer(activeClusterPopup.popup)){const e=filterBusinesses(activeClusterPopup.businesses,currentFilter);if(0===e.length)map.closePopup(activeClusterPopup.popup),activeClusterPopup=null;else{let t='<div class="cluster-popup-content">';e.forEach(e=>{t+=createCardHTML(e)}),t+="</div>",activeClusterPopup.popup.setContent(t),activeClusterPopup.popup.update()}}}window.onload=()=>{buildHierarchicalDropdown(),setupDropdownEvents();const e=new URLSearchParams(window.location.search),t=rawData.map_defaults||{},a=parseFloat(e.get("lat"))||t.lat||37.7749,n=parseFloat(e.get("lng"))||t.long||-122.4194,o=parseInt(e.get("zoom"),10)||t.zoom||15;map=L.map("map",{minZoom:t.min_zoom||10,maxBounds:t.max_bounds||null,maxBoundsViscosity:1}).setView([a,n],o),L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:"&copy; OpenStreetMap &copy; CARTO",maxZoom:20}).addTo(map),updateApp(),document.getElementById("btn-map").onclick=()=>{document.getElementById("map").style.display="block",document.getElementById("list-view").style.display="none",document.getElementById("btn-map").classList.add("active"),document.getElementById("btn-list").classList.remove("active"),currentView="map",updateApp()},document.getElementById("btn-list").onclick=()=>{document.getElementById("map").style.display="none",document.getElementById("list-view").style.display="block",document.getElementById("btn-list").classList.add("active"),document.getElementById("btn-map").classList.remove("active"),currentView="list",updateApp()},document.getElementById("btn-loc").onclick=()=>{if(!navigator.geolocation)return alert("Geolocation not supported");document.getElementById("btn-loc").textContent="‚è≥",navigator.geolocation.getCurrentPosition(e=>{const{latitude:t,longitude:a}=e.coords;userLoc=[t,a],userMarker&&map.removeLayer(userMarker),userMarker=L.circleMarker(userLoc,{radius:8,color:"blue",fillColor:"#2a81cb",fillOpacity:1}).addTo(map),map.setView(userLoc,16),document.getElementById("btn-loc").textContent="üìç Me",updateApp()},e=>{console.error(e),alert("Could not get location."),document.getElementById("btn-loc").textContent="üìç Me"})}};</script></body></html>